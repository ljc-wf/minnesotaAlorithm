/*
 * filtfilt.c
 *
 * Code generation for function 'filtfilt'
 *
 */

/* Include files */
#include "rt_nonfinite.h"
#include "dll1.h"
#include "filtfilt.h"
#include "dll1_emxutil.h"
#include "flipud.h"
#include "filter.h"
#include "mean.h"

// start

void filterECG128Hz(double data[1800], double filtdata[1800])
{
  double d0;
  int i0;
  double aff_lp[1800];
  d0 = mean(data);
  for (i0 = 0; i0 < 1800; i0++) {
    data[i0] -= d0;
  }

  filtfilt2(data, aff_lp);

  b_filtfilt(aff_lp, filtdata);

}

void b_filtfilt(const double x_in[1800], double y_out[1800])
{
  double d3;
  double d4;
  int i;
  double y[3264];
  double a[244];
  double b_y[3264];
  static const double b_a[244] = { 0.000532376671249564, 0.00065938540599740851,
                                   0.00080152021952612407, 0.0009598163929432753, 0.0011353928516670063,
                                   0.001329341491908117, 0.0015428711149660537, 0.001777142694377063,
                                   0.0020334520646856052, 0.0023130680828289491, 0.0026173695526518596,
                                   0.0029477148775176637, 0.003305560380344488, 0.0036922817909384783,
                                   0.0041093706832420951, 0.004558251856639068, 0.0050404581572707254,
                                   0.00555747795189873, 0.0061110032914126521, 0.0067026658063014674,
                                   0.0073342702592112613, 0.0080074783919903518, 0.0087240572580172433,
                                   0.0094855246526901922, 0.01029364832568228, 0.011150086267763273,
                                   0.012057026673169522, 0.013016315784021638, 0.014029835806410379,
                                   0.015098290857377959, 0.016224980127041704, 0.017411185010194584,
                                   0.018658565124457439, 0.019969422037189613, 0.021345322498529773,
                                   0.022788363960265238, 0.024300248989681795, 0.025882987776234042,
                                   0.027538308359239379, 0.029268201712609347, 0.031074405173137202,
                                   0.032958851570761866, 0.034923282373037635, 0.036969545328692288,
                                   0.0390992957575286, 0.041314333571088623, 0.043616315382831,
                                   0.046006987611859493, 0.048487963520518526, 0.051060894625611204,
                                   0.053727255373993338, 0.056488560353215075, 0.059346258503734109,
                                   0.06230185703880288, 0.065356758040399185, 0.068512236265121984,
                                   0.071769447881439047, 0.07512964050160624, 0.078594136604864626,
                                   0.082163770426418481, 0.085839568434284572, 0.089622674845311973,
                                   0.093513687485570249, 0.097513605448549451, 0.10162298419003252,
                                   0.10584255777742482, 0.11017276402030865, 0.11461417952591178,
                                   0.1191670745947833, 0.12383186226971701, 0.12860865905355037,
                                   0.13349762759960485, 0.13849870641314924, 0.14361191430668796,
                                   0.14883701422609208, 0.15417383057230333, 0.15962195583194283,
                                   0.16518098577006166, 0.17085027895175159, 0.1766292551767831,
                                   0.18251713429966535, 0.18851314673167649, 0.19461627290527042,
                                   0.20082548703757103, 0.20713960763298772, 0.21355748997612914,
                                   0.22007770461262724, 0.22669879290302966, 0.23341924297976208,
                                   0.24023748092818134, 0.24715160913223816, 0.25415998191822736,
                                   0.26126051587628774, 0.26845128277879243, 0.27573009012597993,
                                   0.28309482319469048, 0.29054310346912188, 0.29807267654949837,
                                   0.30568096136260176, 0.31336548247904827, 0.32112356837636069,
                                   0.32895258800579619, 0.33684969454912517, 0.34481213857096354,
                                   0.35283693638767444, 0.36092114907048317, 0.36906166737131274,
                                   0.37725547593531389, 0.38549935787220391, 0.39379015473068835,
                                   0.40212452256455411, 0.41049922183588322, 0.41891085946482148,
                                   0.42735609389221046, 0.43583139156968753, 0.44433337078726876,
                                   0.4528585029588939, 0.46140330222079107, 0.46996415620023951,
                                   0.47853763070321859, 0.48712000202638622, 0.49570779251515068,
                                   -0.49570265957409393, -0.48711486908532947, -0.47853249776216183,
                                   -0.46995902325918276, -0.46139816927973432, -0.45285337001783715,
                                   -0.444328237846212, -0.43582625862863078, -0.42735096095115371,
                                   -0.41890572652376473, -0.41049408889482647, -0.40211938962349736,
                                   -0.3937850217896316, -0.38549422493114716, -0.37725034299425714,
                                   -0.369056534430256, -0.36091601612942642, -0.35283180344661769,
                                   -0.34480700562990679, -0.33684456160806842, -0.32894745506473944,
                                   -0.32111843543530394, -0.31336034953799152, -0.305675828421545,
                                   -0.29806754360844162, -0.29053797052806513, -0.28308969025363373,
                                   -0.27572495718492318, -0.26844614983773568, -0.261255382935231,
                                   -0.25415484897717061, -0.24714647619118141, -0.24023234798712459,
                                   -0.23341411003870532, -0.22669365996197291, -0.22007257167157049,
                                   -0.21355235703507239, -0.20713447469193097, -0.20082035409651428,
                                   -0.19461113996421367, -0.18850801379061974, -0.18251200135860859,
                                   -0.17662412223572635, -0.17084514601069484, -0.1651758528290049,
                                   -0.15961682289088608, -0.15416869763124658, -0.14883188128503533,
                                   -0.14360678136563121, -0.13849357347209248, -0.13349249465854809,
                                   -0.12860352611249362, -0.12382672932866028, -0.11916194165372657,
                                   -0.11460904658485505, -0.11016763107925191, -0.10583742483636809,
                                   -0.10161785124897578, -0.097508472507492713, -0.093508554544513511,
                                   -0.089617541904255235, -0.085834435493227834, -0.082158637485361743,
                                   -0.078589003663807888, -0.0751245075605495, -0.071764314940382309,
                                   -0.068507103324065247, -0.065351625099342447, -0.062296724097746142,
                                   -0.059341125562677371, -0.056483427412158338, -0.0537221224329366,
                                   -0.051055761684554467, -0.048482830579461789, -0.046001854670802755,
                                   -0.043611182441774261, -0.041309200630031885, -0.039094162816471864,
                                   -0.036964412387635551, -0.0349181494319809, -0.032953718629705128,
                                   -0.031069272232080464, -0.02926306877155261, -0.027533175418182641,
                                   -0.025877854835177305, -0.024295116048625057, -0.0227832310192085,
                                   -0.021340189557473035, -0.019964289096132876, -0.018653432183400702,
                                   -0.017406052069137846, -0.016219847185984966, -0.015093157916321223,
                                   -0.014024702865353643, -0.013011182842964902, -0.012051893732112786,
                                   -0.011144953326706538, -0.010288515384625545, -0.0094803917116334582,
                                   -0.00871892431696051, -0.0080023454509336178, -0.0073291373181545282,
                                   -0.0066975328652447343, -0.006105870350355919, -0.0055523450108419959,
                                   -0.0050353252162139914, -0.004553118915582334, -0.0041042377421853611,
                                   -0.0036871488498817443, -0.0033004274392877541, -0.0029425819364609297,
                                   -0.0026122366115951257, -0.0023079351417722147, -0.0020283191236288708,
                                   -0.0017720097533203284, -0.0015377381739093191, -0.0013242085508513824,
                                   -0.0011302599106102716, -0.00095468345188654056, -0.00079638727846938933,
                                   -0.00065425246494067377, -0.00052724373019282932 };

  static const double dv1[245] = { -0.00052724373019282932,
                                   -0.0001270087347478445, -0.00014213481352871559, -0.00015829617341715129,
                                   -0.000175576458723731, -0.0001939486402411108, -0.00021352962305793669,
                                   -0.0002342715794110092, -0.00025630937030854221, -0.00027961601814334409,
                                   -0.0003043014698229107, -0.000330345324865804, -0.00035784550282682448,
                                   -0.00038672141059399042, -0.000417088892303617, -0.00044888117339697282,
                                   -0.0004822063006316578, -0.00051701979462800474, -0.00055352533951392264,
                                   -0.00059166251488881525, -0.00063160445290979356, -0.00067320813277909025,
                                   -0.00071657886602689174, -0.00076146739467294953, -0.00080812367299208741,
                                   -0.00085643794208099258, -0.000906940405406248, -0.00095928911085211687,
                                   -0.00101352002238874, -0.0010684550509675809, -0.001126689269663744,
                                   -0.0011862048831528811, -0.0012473801142628561, -0.0013108569127321739,
                                   -0.001375900461340159, -0.001443041461735466, -0.001511885029416557,
                                   -0.0015827387865522469, -0.001655320583005337, -0.00172989335336997,
                                   -0.0018062034605278549, -0.001884446397624664, -0.0019644308022757728,
                                   -0.002046262955654651, -0.0021297504288363129, -0.002215037813560021,
                                   -0.0023019818117423789, -0.002390672229028491, -0.002480975908659032,
                                   -0.002572931105092679, -0.0026663607483821362, -0.0027613049792217341,
                                   -0.0028576981505190318, -0.0029555985350687738, -0.0030549010015963082,
                                   -0.0031554782247228031, -0.0032572116163170619, -0.00336019262016719,
                                   -0.003464496103258388, -0.0035696338215538562, -0.0036757980078660959,
                                   -0.0037831064110274018, -0.0038910126402582719, -0.0039999179629792011,
                                   -0.0041093787414830706, -0.0042195735873923014, -0.0043302062428838264,
                                   -0.0044414155056031268, -0.0045528950688715174, -0.00466478767493371,
                                   -0.0047767967838333557, -0.0048889685460544712, -0.0050010788135443993,
                                   -0.00511320789353872, -0.00522509991940413, -0.0053368163462112587,
                                   -0.005448125259639512, -0.0055590299381188353, -0.0056692931816899458,
                                   -0.0057789762250315038, -0.0058878791228822447, -0.0059960124320111484,
                                   -0.0061031261735939183, -0.0062092141323006073, -0.0063141205954167067,
                                   -0.00641788234314142, -0.0065202146364981, -0.0066210882904024207,
                                   -0.0067204500767324036, -0.0068182379484192611, -0.0069141282040568316,
                                   -0.0070083727859892057, -0.0071005339580603984, -0.0071907669025047093,
                                   -0.0072788073471874914, -0.0073647330687105616, -0.0074482802744313759,
                                   -0.0075295730803765218, -0.0076082848131033979, -0.0076845211164465214,
                                   -0.0077580858973124332, -0.00782901962943547, -0.0078971065433289921,
                                   -0.0079624440218383739, -0.00802479781671087, -0.0080842126828087526,
                                   -0.0081405183008295585, -0.00819380856400116, -0.0082438819368900219,
                                   -0.0082907968584844463, -0.0083343678338657634, -0.0083746992713291026,
                                   -0.0084116376289382518, -0.0084452344273889587, -0.0084752976774770689,
                                   -0.0085019792175812, -0.0085251321716251442, -0.0085447992618971364,
                                   -0.0085608539794484566, -0.00857347450297906, -0.008582371323167616,
                                   -0.00858779048876446, 0.99141045208924461, -0.00858779048876446,
                                   -0.008582371323167616, -0.00857347450297906, -0.0085608539794484566,
                                   -0.0085447992618971364, -0.0085251321716251442, -0.0085019792175812,
                                   -0.0084752976774770689, -0.0084452344273889587, -0.0084116376289382518,
                                   -0.0083746992713291026, -0.0083343678338657634, -0.0082907968584844463,
                                   -0.0082438819368900219, -0.00819380856400116, -0.0081405183008295585,
                                   -0.0080842126828087526, -0.00802479781671087, -0.0079624440218383739,
                                   -0.0078971065433289921, -0.00782901962943547, -0.0077580858973124332,
                                   -0.0076845211164465214, -0.0076082848131033979, -0.0075295730803765218,
                                   -0.0074482802744313759, -0.0073647330687105616, -0.0072788073471874914,
                                   -0.0071907669025047093, -0.0071005339580603984, -0.0070083727859892057,
                                   -0.0069141282040568316, -0.0068182379484192611, -0.0067204500767324036,
                                   -0.0066210882904024207, -0.0065202146364981, -0.00641788234314142,
                                   -0.0063141205954167067, -0.0062092141323006073, -0.0061031261735939183,
                                   -0.0059960124320111484, -0.0058878791228822447, -0.0057789762250315038,
                                   -0.0056692931816899458, -0.0055590299381188353, -0.005448125259639512,
                                   -0.0053368163462112587, -0.00522509991940413, -0.00511320789353872,
                                   -0.0050010788135443993, -0.0048889685460544712, -0.0047767967838333557,
                                   -0.00466478767493371, -0.0045528950688715174, -0.0044414155056031268,
                                   -0.0043302062428838264, -0.0042195735873923014, -0.0041093787414830706,
                                   -0.0039999179629792011, -0.0038910126402582719, -0.0037831064110274018,
                                   -0.0036757980078660959, -0.0035696338215538562, -0.003464496103258388,
                                   -0.00336019262016719, -0.0032572116163170619, -0.0031554782247228031,
                                   -0.0030549010015963082, -0.0029555985350687738, -0.0028576981505190318,
                                   -0.0027613049792217341, -0.0026663607483821362, -0.002572931105092679,
                                   -0.002480975908659032, -0.002390672229028491, -0.0023019818117423789,
                                   -0.002215037813560021, -0.0021297504288363129, -0.002046262955654651,
                                   -0.0019644308022757728, -0.001884446397624664, -0.0018062034605278549,
                                   -0.00172989335336997, -0.001655320583005337, -0.0015827387865522469,
                                   -0.001511885029416557, -0.001443041461735466, -0.001375900461340159,
                                   -0.0013108569127321739, -0.0012473801142628561, -0.0011862048831528811,
                                   -0.001126689269663744, -0.0010684550509675809, -0.00101352002238874,
                                   -0.00095928911085211687, -0.000906940405406248, -0.00085643794208099258,
                                   -0.00080812367299208741, -0.00076146739467294953, -0.00071657886602689174,
                                   -0.00067320813277909025, -0.00063160445290979356, -0.00059166251488881525,
                                   -0.00055352533951392264, -0.00051701979462800474, -0.0004822063006316578,
                                   -0.00044888117339697282, -0.000417088892303617, -0.00038672141059399042,
                                   -0.00035784550282682448, -0.000330345324865804, -0.0003043014698229107,
                                   -0.00027961601814334409, -0.00025630937030854221, -0.0002342715794110092,
                                   -0.00021352962305793669, -0.0001939486402411108, -0.000175576458723731,
                                   -0.00015829617341715129, -0.00014213481352871559, -0.0001270087347478445,
                                   -0.00052724373019282932 };

  double c_y[3264];
  d3 = 2.0 * x_in[0];
  d4 = 2.0 * x_in[1799];
  for (i = 0; i < 732; i++) {
    y[i] = d3 - x_in[732 - i];
  }

  memcpy(&y[732], &x_in[0], 1800U * sizeof(double));
  for (i = 0; i < 732; i++) {
    y[i + 2532] = d4 - x_in[1798 - i];
  }

  for (i = 0; i < 244; i++) {
    a[i] = b_a[i] * y[0];
  }

  memcpy(&b_y[0], &y[0], 3264U * sizeof(double));
  b_filter(dv1, b_y, a, y);
  b_flipud(y);
  for (i = 0; i < 244; i++) {
    a[i] = b_a[i] * y[0];
  }

  memcpy(&c_y[0], &y[0], 3264U * sizeof(double));
  b_filter(dv1, c_y, a, y);
  b_flipud(y);
  memcpy(&y_out[0], &y[732], 1800U * sizeof(double));
}

void filtfilt2(const double x_in[1800], double y_out[1800])
{
  double d1;
  double d2;
  int i;
  double y[1968];
  double a[28];
  double b_y[1968];
  static const double b_a[28] = { 1.0007791280298255, 1.0197488555930274,
                                  1.024924186426607, 1.0066407198649283, 1.0072426071603835, 1.026218227832584,
                                  1.0059772430570171, 0.98590172289404643, 1.0261937780726011,
                                  1.0222131390180484, 0.95198935879973468, 1.0113630029503655,
                                  1.0995924685350873, 0.79630183247151654, 0.19664098254198625,
                                  -0.10664965352158447, -0.018420187936862772, 0.040953456213768058,
                                  -0.0292703240045457, -0.033250963059098325, 0.0070410921194564366,
                                  -0.013034428043514203, -0.033275412819081154, -0.014299792146880562,
                                  -0.013697904851425483, -0.031981371413104073, -0.026806040579524525,
                                  -0.0078363130163226352 };

  static const double dv0[29] = { -0.0078363130163226352, -0.01896972756320189,
                                  -0.0051753308335795454, 0.018283466561678591, -0.00060188729545508017,
                                  -0.018975620672200589, 0.020240984775566951, 0.02007552016297064,
                                  -0.040292055178554761, 0.0039806390545526231, 0.070223780218313755,
                                  -0.05937364415063083, -0.0882294655847217, 0.30329063606357071,
                                  0.59966084992953028, 0.30329063606357071, -0.0882294655847217,
                                  -0.05937364415063083, 0.070223780218313755, 0.0039806390545526231,
                                  -0.040292055178554761, 0.02007552016297064, 0.020240984775566951,
                                  -0.018975620672200589, -0.00060188729545508017, 0.018283466561678591,
                                  -0.0051753308335795454, -0.01896972756320189, -0.0078363130163226352 };

  double c_y[1968];
  d1 = 2.0 * x_in[0];
  d2 = 2.0 * x_in[1799];
  for (i = 0; i < 84; i++) {
    y[i] = d1 - x_in[84 - i];
  }

  memcpy(&y[84], &x_in[0], 1800U * sizeof(double));
  for (i = 0; i < 84; i++) {
    y[i + 1884] = d2 - x_in[1798 - i];
  }

  for (i = 0; i < 28; i++) {
    a[i] = b_a[i] * y[0];
  }

  memcpy(&b_y[0], &y[0], 1968U * sizeof(double));
  filter2(dv0, b_y, a, y);
  flipud2(y);
  for (i = 0; i < 28; i++) {
    a[i] = b_a[i] * y[0];
  }

  memcpy(&c_y[0], &y[0], 1968U * sizeof(double));
  filter2(dv0, c_y, a, y);
  flipud2(y);
  memcpy(&y_out[0], &y[84], 1800U * sizeof(double));
}

/* End of code generation (filtfilt.c) */


// end

/* Function Definitions */
void filtfilt(const double x_in_data[], const int x_in_size[1], emxArray_real_T *
              y_out)
{
  int x_size_idx_0;
  int loop_ub;
  double x_data[2205];
  int i2;
  double d0;
  double d1;
  double y_data[2241];
  //double a[6];
  double b_y_data[2241];
  static const double b_a[7] = { 0.0062969719124241208, 0, -0.0189, 0 , 0.0189,0, -0.0062969719124292105 };

  static const double a[7] = {1, -4.8, 10, -11.4, 7.5, -2.7, 0.43};

  int y_size[1];
  int b_y_size[1];
  int c_y_size[1];
  int tmp_data[2205];
  if (x_in_size[0] == 1) {
    x_size_idx_0 = 1;
    x_data[0] = x_in_data[0];
  } else {
    x_size_idx_0 = x_in_size[0];
    loop_ub = x_in_size[0];
    for (i2 = 0; i2 < loop_ub; i2++) {
      x_data[i2] = x_in_data[i2];
    }
  }

  if (x_size_idx_0 == 0) {
    i2 = y_out->size[0] * y_out->size[1];
    y_out->size[0] = 0;
    y_out->size[1] = 0;
    emxEnsureCapacity((emxArray__common *)y_out, i2, (int)sizeof(double));
  } else {
    d0 = 2.0 * x_data[0];
    d1 = 2.0 * x_data[x_size_idx_0 - 1];
    for (i2 = 0; i2 < 18; i2++) {
      y_data[i2] = d0 - x_data[18 - i2];
    }

    for (i2 = 0; i2 < x_size_idx_0; i2++) {
      y_data[i2 + 18] = x_data[i2];
    }

    for (i2 = 0; i2 < 18; i2++) {
      y_data[(i2 + x_size_idx_0) + 18] = d1 - x_data[(x_size_idx_0 - i2) - 2];
    }
/*
    for (i2 = 0; i2 < 6; i2++) {
      a[i2] = b_a[i2] * y_data[0];
    }
*/
    y_size[0] = 36 + x_size_idx_0;
    loop_ub = 36 + x_size_idx_0;
    for (i2 = 0; i2 < loop_ub; i2++) {
      b_y_data[i2] = y_data[i2];
    }

    filter(b_y_data, y_size, a, y_data, b_y_size);
    flipud(y_data, b_y_size);
   /*
    for (i2 = 0; i2 < 6; i2++) {
      a[i2] = b_a[i2] * y_data[0];
    }
*/
    c_y_size[0] = b_y_size[0];
    loop_ub = b_y_size[0];
    for (i2 = 0; i2 < loop_ub; i2++) {
      b_y_data[i2] = y_data[i2];
    }

    filter(b_y_data, c_y_size, a, y_data, b_y_size);
    flipud(y_data, b_y_size);
    if (x_in_size[0] == 1) {
      i2 = y_out->size[0] * y_out->size[1];
      y_out->size[0] = 1;
      y_out->size[1] = x_size_idx_0;
      emxEnsureCapacity((emxArray__common *)y_out, i2, (int)sizeof(double));
      for (i2 = 0; i2 < x_size_idx_0; i2++) {
        y_out->data[y_out->size[0] * i2] = y_data[18 + i2];
      }
    } else {
      i2 = y_out->size[0] * y_out->size[1];
      y_out->size[0] = x_size_idx_0;
      y_out->size[1] = 1;
      emxEnsureCapacity((emxArray__common *)y_out, i2, (int)sizeof(double));
      for (i2 = 0; i2 < x_size_idx_0; i2++) {
        tmp_data[i2] = 19 + i2;
      }

      for (i2 = 0; i2 < x_size_idx_0; i2++) {
        y_out->data[i2] = y_data[tmp_data[i2] - 1];
      }
    }
  }
}

/* End of code generation (filtfilt.c) */
